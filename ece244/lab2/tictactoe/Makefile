# remove ALL implicit rules & all suffixes
MAKEFLAGS+=-r
.SUFFIXES:
.SECONDEXPANSION:

# ############################################ LAB  ################################################

# ECE244 root directory
ECE244_ROOT_DIR = /share/copy/ece244f

# This lab's root directory
LAB_ROOT_DIR = $(ECE244_ROOT_DIR)/lab2

# This lab's source files directory
LAB_SRC_DIR = $(LAB_ROOT_DIR)/src

# This lab's object files directory
LAB_OBJ_DIR = $(LAB_ROOT_DIR)/obj

# This lab's source files (all of the source files)
LAB_SRC_FILES = tictactoe.cpp gameState.cpp displayServer.cpp  textServer.cpp playMove.cpp

# This lab's source files to be written by the students
STUDENT_SRC_FILES = playMove.cpp gameState.cpp

# This lab's source files to be written by the students for the optional part 
STUDENT_OPT_SRC_FILES = playMove.cpp gameState.cpp tictactoe.cpp displayServer.cpp

# This lab's object files 
LAB_OBJ_FILES = $(patsubst %.cpp,%.o,$(LAB_SRC_FILES))

# This lab's object files generated by the students
STUDENT_OBJ_FILES = $(patsubst %.cpp,%.o,$(STUDENT_SRC_FILES))

# This lab's object files generated by the students for the optional part
STUDENT_OPT_OBJ_FILES = $(patsubst %.cpp,%.o,$(STUDENT_OPT_SRC_FILES))

# This lab's object files to go into the library
# This is just all the source files less the ones written by the students
LIB_OBJ_FILES = $(filter-out $(STUDENT_OBJ_FILES),$(LAB_OBJ_FILES))

# This lab's library directory
LAB_LIB_DIR = $(LAB_ROOT_DIR)/lib

# This lab's library name (assuming only one)
LAB_LIB_NAME = TicTacTo

# This lab's library
LAB_LIB = $(patsubst %,lib%.a,$(LAB_LIB_NAME))

# This lab's link flags
LAB_LINK_FLAGS = $(patsubst %,-L%,$(LAB_LIB_DIR)) $(patsubst %,-l%,$(LAB_LIB_NAME))

# This lab's executable directory
LAB_EXE_DIR = $(LAB_ROOT_DIR)/bin

# This lab's release directory
LAB_RELEASE_DIR = $(LAB_ROOT_DIR)/release

# This lab's optional part release directory
LAB_OPT_RELEASE_DIR = $(LAB_ROOT_DIR)/opt-release

# This lab's autotest directory
LAB_AUTOTEST_DIR = $(LAB_ROOT_DIR)/autotest

# This lab's include directory/flags
LAB_INCL_DIR = $(LAB_ROOT_DIR)/include
LAB_INCL_FLAGS = $(patsubst %,-I%,$(LAB_INCL_DIR))
 
# The executable
EXECUTABLE = tictactoe.exe

# The release zip file
LAB_RELEASE_FILE = lab2_release.zip

# The optional part release zip file
LAB_RELEASE_FILE = lab2_opt-release.zip

############################################ SFML ################################################
# SFML directories
SFML_ROOT_DIR = $(ECE244_ROOT_DIR)/SFML-2.4.2
SFML_LIB_DIRS = $(SFML_ROOT_DIR)/lib /lib64 
SFML_INCL_DIRS = $(SFML_ROOT_DIR)/include

# SFML inlcude flags
SFML_INCL_FLAGS = $(patsubst %,-I%,$(SFML_INCL_DIRS))

# SFML library names
SFML_LIB_NAMES = sfml-audio-s sfml-network-s sfml-graphics-s sfml-window-s \
                 sfml-system-s :libudev.so.0 Xrandr pthread rt GL SM ICE \
                 X11 Xext freetype jpeg :libFLAC.so.8 vorbis vorbisenc ogg \
                 vorbisfile 

# SFML link flags
SFML_LINK_FLAGS = $(patsubst %,-L%,$(SFML_LIB_DIRS)) $(patsubst %,-l%,$(SFML_LIB_NAMES))

# Include flags
INCLUDE_FLAGS = -I . $(LAB_INCL_FLAGS) $(SFML_INCL_FLAGS)

# Link flags
LINK_FLAGS = $(LAB_LINK_FLAGS) $(SFML_LINK_FLAGS)

# Some compile flags; they go to both the compiler and the linker
WARNING_FLAGS = -Wall -Wextra -pedantic
EXTRA_FLAGS = -std=c++11

# Compile and ld flags
CXX_FLAGS = $(INCLUDE_FLAGS) $(WARNING_FLAGS) $(EXTRA_FLAGS)
LD_FLAGS  = $(LINK_FLAGS) $(WARNING_FLAGS) $(EXTRA_FLAGS)

# The compiler
CXX = g++


###################################### RULES ##################################
# The executable
EXECUTABLE = tictactoe.exe

all: ../exe/$(EXECUTABLE)

../exe/$(EXECUTABLE):	 $(patsubst %,../obj/%,$(STUDENT_OBJ_FILES)) $(LAB_LIB_DIR)/$(LAB_LIB) Makefile
	$(CXX) $(patsubst %,../obj/%,$(STUDENT_OBJ_FILES)) -o ../exe/$(EXECUTABLE) $(LD_FLAGS)

../obj/%.o:	../tictactoe/%.cpp  Makefile
	$(CXX) $(CXX_FLAGS) -c $< -o $@

clean:
	@rm -f ../exe/$(EXECUTABLE) ../obj/*.o core 

